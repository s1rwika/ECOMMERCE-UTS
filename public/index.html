<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Manager</title>
</head>
<body>
  <h1>Daftar Produk</h1>
  <button onclick="loadProducts()">Refresh Produk</button>
  <button onclick="addProduct()">Tambah Produk</button>
  <ul id="productList"></ul>

  <script>
    let products = [];

    async function loadProducts() {
      try {
        const response = await fetch("http://52.65.176.248:50000/products");
        products = await response.json();

        const productList = document.getElementById('productList');
        productList.innerHTML = '';

        products.forEach(product => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `
            <strong>${product.name}</strong> - Rp${product.price} <br>
            <img src="${product.image_url}" alt="${product.name}" width="100"> <br>
            <button onclick="editProduct(${product.id})">Edit</button>
            <button onclick="deleteProduct(${product.id})">Hapus</button>
          `;
          productList.appendChild(listItem);
        });
      } catch (error) {
        console.error("Gagal memuat produk:", error);
        alert("Gagal memuat produk");
      }
    }

    async function addProduct() {
      const name = prompt("Masukkan nama produk baru:");
      if (name === null || name.trim() === "") return;

      const price = prompt("Masukkan harga produk baru:");
      if (price === null || price.trim() === "" || isNaN(price)) return;

      const image_url = prompt("Masukkan URL gambar produk:");
      if (image_url === null || image_url.trim() === "") return;

      const newProduct = {
        name: name.trim(),
        price: parseInt(price),
        image_url: image_url.trim()
      };

      try {
        const response = await fetch(`http://52.65.176.248:50000/products-create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(newProduct)
        });

        const result = await response.json();
        if (response.ok) {
          alert("Produk berhasil ditambahkan!");
          loadProducts();
        } else {
          alert("Gagal menambahkan produk: " + (result.error || ""));
        }
      } catch (error) {
        console.error("Error saat menambahkan produk:", error);
        alert("Gagal menambahkan produk.");
      }
    }

    async function editProduct(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) {
        alert("Produk tidak ditemukan!");
        return;
      }

      const newName = prompt("Masukkan nama produk baru:", product.name);
      if (newName === null) return;

      const newPrice = prompt("Masukkan harga produk baru:", product.price);
      if (newPrice === null) return;

      const updatedProduct = {
        name: newName.trim(),
        price: parseInt(newPrice),
        image_key: product.image_key
      };

      try {
        const response = await fetch(`http://52.65.176.248:50000/products-update/${productId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updatedProduct)
        });

        const result = await response.json();
        if (response.ok) {
          alert("Produk berhasil diperbarui!");
          loadProducts();
        } else {
          alert("Gagal memperbarui produk: " + (result.error || ""));
        }
      } catch (error) {
        console.error("Error saat memperbarui produk:", error);
        alert("Gagal memperbarui produk.");
      }
    }

    async function deleteProduct(productId) {
      if (!confirm("Apakah Anda yakin ingin menghapus produk ini?")) return;

      try {
        const response = await fetch(`http://52.65.176.248:50000/products-delete/${productId}`, {
          method: 'DELETE'
        });

        const result = await response.json();
        if (response.ok) {
          alert("Produk berhasil dihapus!");
          loadProducts();
        } else {
          alert("Gagal menghapus produk: " + (result.error || ""));
        }
      } catch (error) {
        console.error("Error saat menghapus produk:", error);
        alert("Gagal menghapus produk.");
      }
    }

    // Load produk di awal
    loadProducts();
  </script>
</body>
</html>
